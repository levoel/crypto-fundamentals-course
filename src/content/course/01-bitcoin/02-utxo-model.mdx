---
title: "UTXO Model"
description: "Unspent Transaction Output — модель данных Bitcoin для отслеживания балансов"
difficulty: "intermediate"
timeToComplete: 20
---

import { UTXODiagram } from '../../../components/diagrams/BitcoinDiagrams';

# UTXO Model

UTXO (Unspent Transaction Output) — фундаментальная модель данных Bitcoin. В отличие от банковских систем, где хранится баланс аккаунта, Bitcoin хранит набор **неизрасходованных выходов транзакций**.

## Концепция

<Callout type="note">
В Bitcoin нет понятия "баланс аккаунта". Есть только UTXO — монеты, которые можно потратить.
</Callout>

### Аналогия с наличными

Представь кошелёк с купюрами:
- У тебя есть купюры: 100₽, 50₽, 20₽ (это UTXO)
- Твой "баланс" = 170₽ (сумма всех купюр)
- Чтобы заплатить 70₽, ты отдаёшь 100₽ и получаешь сдачу 30₽

<UTXODiagram client:load />

### Структура транзакции

```json
{
  "txid": "abc123...",
  "inputs": [
    {
      "prev_txid": "def456...",
      "prev_output_index": 0,
      "script_sig": "..."
    }
  ],
  "outputs": [
    {
      "value": 70000000,  // satoshi (0.7 BTC)
      "script_pubkey": "OP_DUP OP_HASH160 <recipient_hash> OP_EQUALVERIFY OP_CHECKSIG"
    },
    {
      "value": 29990000,  // сдача минус fee
      "script_pubkey": "OP_DUP OP_HASH160 <my_hash> OP_EQUALVERIFY OP_CHECKSIG"
    }
  ]
}
```

## UTXO Set

**UTXO Set** — это текущее состояние всех неизрасходованных выходов:

| Метрика | Значение (примерное) |
|---------|----------------------|
| Количество UTXO | ~80 млн |
| Размер UTXO Set | ~5 GB |
| Средний возраст UTXO | ~2.5 года |

<Callout type="warning">
UTXO Set хранится в памяти для быстрой валидации. Это bottleneck для масштабирования.
</Callout>

## Преимущества UTXO

### 1. Параллельная валидация

Каждый input независим — транзакции можно валидировать параллельно:

```python
def validate_transaction(tx):
    # Каждый input проверяется независимо
    for input in tx.inputs:
        if not verify_signature(input):
            return False
        if not utxo_exists(input.prev_txid, input.prev_output_index):
            return False
    return True
```

### 2. Простое определение double-spend

Если UTXO потрачен — он удаляется из set. Попытка потратить снова = ошибка.

### 3. Privacy через change addresses

Каждая транзакция создаёт новый UTXO для сдачи на новый адрес.

## Недостатки UTXO

### 1. Сложность для smart contracts

UTXO — stateless. Нельзя хранить состояние контракта между транзакциями.

### 2. Dust problem

Маленькие UTXO (< fee для траты) становятся неликвидными:

```
UTXO: 500 satoshi
Fee для траты: 1000 satoshi
Результат: UTXO заблокирован навсегда
```

### 3. UTXO consolidation

Большое количество маленьких UTXO увеличивает размер транзакций (больше inputs = больше fee).

## Анализ UTXO данных

```sql
-- Распределение UTXO по размеру
SELECT
    CASE
        WHEN value < 10000 THEN 'dust (<0.0001 BTC)'
        WHEN value < 1000000 THEN 'small (0.0001-0.01 BTC)'
        WHEN value < 100000000 THEN 'medium (0.01-1 BTC)'
        ELSE 'large (>1 BTC)'
    END as size_category,
    COUNT(*) as utxo_count,
    SUM(value) / 1e8 as total_btc
FROM bitcoin.utxo_set
GROUP BY size_category;
```

## UTXO vs Account Model

| Аспект | UTXO (Bitcoin) | Account (Ethereum) |
|--------|----------------|-------------------|
| State | Набор UTXO | Mapping address → balance |
| Параллелизм | Высокий | Низкий (nonce) |
| Privacy | Лучше | Хуже |
| Smart contracts | Ограничены | Полноценные |
| Dust | Проблема | Нет |

## Резюме

- UTXO = неизрасходованный выход транзакции
- Баланс = сумма всех UTXO принадлежащих адресу
- Транзакция тратит inputs и создаёт outputs
- UTXO Set ~5GB, хранится в RAM для быстрой валидации
- Модель оптимизирована для параллелизма и privacy, но не для smart contracts
