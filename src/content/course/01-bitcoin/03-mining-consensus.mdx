---
title: "Mining & Proof of Work"
description: "Механизм консенсуса Bitcoin: Proof of Work, difficulty adjustment, block rewards"
difficulty: "intermediate"
timeToComplete: 20
---

# Mining & Proof of Work

Mining — процесс создания новых блоков в Bitcoin. Это не просто "добыча монет", а критически важный механизм **консенсуса** и **безопасности** сети.

## Proof of Work

<Callout type="info">
PoW превращает электричество в безопасность сети. Чем больше hashrate, тем дороже атака.
</Callout>

### Задача майнера

Найти такой `nonce`, чтобы:

```
SHA256(SHA256(block_header)) < target
```

Где `block_header` включает:

```python
block_header = {
    'version': 0x20000000,
    'prev_block_hash': '000000000000000000...',
    'merkle_root': 'abc123...',
    'timestamp': 1706900000,
    'bits': 0x17034219,  # compact target
    'nonce': ???  # перебираем
}
```

### Пример хеша

```
Target:  0x00000000000000000003421900000000000000000000000000000000000000
Hash 1:  0x8a5f2e... (не подходит, слишком большой)
Hash 2:  0x0000000000000000000234... (подходит!)
```

### Вероятность успеха

При difficulty ~50T:
- Вероятность найти блок за 1 хеш: ~1/50,000,000,000,000
- При hashrate 100 TH/s: ~2 блока в год

## Difficulty Adjustment

<Callout type="warning">
Bitcoin автоматически регулирует сложность каждые 2016 блоков (~2 недели) для поддержания 10-минутного интервала.
</Callout>

### Формула

```python
new_difficulty = old_difficulty * (2016 * 10 minutes / actual_time)

# Ограничение: изменение не более чем в 4 раза
new_difficulty = clamp(new_difficulty,
                       old_difficulty / 4,
                       old_difficulty * 4)
```

### Исторические данные

| Год | Hashrate | Difficulty |
|-----|----------|------------|
| 2010 | 1 MH/s | 1 |
| 2015 | 400 PH/s | 50B |
| 2020 | 120 EH/s | 15T |
| 2024 | 500 EH/s | 70T |

## Block Reward

Награда за блок состоит из:

1. **Block subsidy** — новые монеты (уменьшается в 2 раза каждые 210,000 блоков)
2. **Transaction fees** — сумма всех fees в блоке

### Halving Schedule

```
2009: 50 BTC
2012: 25 BTC (halving #1)
2016: 12.5 BTC (halving #2)
2020: 6.25 BTC (halving #3)
2024: 3.125 BTC (halving #4)
...
2140: 0 BTC (последний satoshi)
```

<Callout type="info">
После 2140 года майнеры будут получать только transaction fees. Это создаёт long-term fee market.
</Callout>

## Mining Economics

### Себестоимость

```python
cost_per_block = (electricity_kwh * price_per_kwh +
                  hardware_depreciation +
                  cooling +
                  rent)

# Пример (2024):
# 1 блок ≈ 100-200 MWh при текущем hashrate
# При $0.05/kWh = $5,000-10,000 на электричество
```

### Breakeven Analysis

| Метрика | Значение |
|---------|----------|
| Block reward | 3.125 BTC |
| BTC price | $40,000 |
| Revenue per block | $125,000 |
| Network hashrate | 500 EH/s |
| Blocks per day | 144 |

## Mining Pools

Solo mining непрактичен — variance слишком высока. Mining pools позволяют:

1. Объединить hashrate
2. Получать стабильный доход (пропорционально вкладу)
3. Платить pool fee (1-3%)

### Распределение Pool Rewards

```
Pool hashrate: 50 EH/s (10% сети)
Твой hashrate: 500 TH/s (1% пула)

Ожидаемый доход:
= 144 блоков/день * 10% * 1% * 3.125 BTC
= 0.45 BTC/день (без учёта fee и variance)
```

## Безопасность

### 51% Attack

Атакующий с >50% hashrate может:
- Делать double-spend
- Цензурировать транзакции
- НЕ может: красть чужие монеты, создавать монеты из воздуха

### Стоимость атаки

```
Hourly cost = network_hashrate * efficiency * electricity_price
            ≈ 500 EH/s * 30 J/TH * $0.05/kWh
            ≈ $750,000/час

1-hour 51% attack ≈ $750,000 + hardware rental
```

<Callout type="warning">
Реорганизация на 6 блоков требует ~1 часа атаки. Поэтому exchanges ждут 6 confirmations.
</Callout>

## Данные для анализа

```sql
-- Анализ mining metrics
SELECT
    DATE(block_timestamp) as date,
    COUNT(*) as blocks,
    AVG(difficulty) as avg_difficulty,
    SUM(block_reward) / 1e8 as total_reward_btc,
    SUM(total_fees) / 1e8 as total_fees_btc
FROM bitcoin.blocks
WHERE block_timestamp > '2024-01-01'
GROUP BY DATE(block_timestamp);
```

## Резюме

- PoW = SHA256(SHA256(header)) < target
- Difficulty adjusts каждые 2016 блоков для 10-минутного интервала
- Block reward = subsidy + fees; halving каждые 210,000 блоков
- Mining pools снижают variance
- 51% атака стоит ~$750,000/час, но не позволяет красть монеты
