---
title: "Polkadot & Parachains"
description: "Polkadot architecture: Relay Chain, Parachains, XCMP, Substrate"
difficulty: "intermediate"
timeToComplete: 20
---

# Polkadot & Parachains

Polkadot — ещё один ответ на вопрос "как масштабировать blockchains". Если Cosmos говорит "каждый chain независим", Polkadot говорит "давайте shared security, но separate execution".

Gavin Wood (co-founder Ethereum, создал Solidity) основал Polkadot с идеей: blockchain security — самое сложное и дорогое. Почему каждый chain должен bootstrap свой validator set? Лучше иметь **один очень secure chain** (Relay Chain), который обеспечивает security для многих **специализированных chains** (parachains).

Для data engineer Polkadot интересен тем, что:
- **Substrate** — мощный framework для custom chains с unified data model
- **Parachains** — separate state, но connected через Relay Chain
- **XCM messages** — cross-chain data flow для analysis
- **Slot auctions** — unique economic data (crowdloans, bids)

## Architecture

Ключевое отличие Polkadot от Cosmos: **shared security**. В Cosmos каждый chain имеет свой validator set. В Polkadot все parachains защищены **одним** validator set Relay Chain. Это упрощает security bootstrapping, но создаёт competition за parachain slots.

<Callout type="note">
Polkadot's insight: разделить консенсус и execution. Relay Chain обеспечивает security, parachains — execution.
</Callout>

```
┌─────────────────────────────────────────────────────────────┐
│                    Polkadot Network                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                    ┌───────────────────┐                    │
│                    │   Relay Chain     │                    │
│                    │   (DOT staking,   │                    │
│                    │    consensus)     │                    │
│                    └─────────┬─────────┘                    │
│                              │                              │
│         ┌────────────────────┼────────────────────┐         │
│         │                    │                    │         │
│    ┌────┴────┐          ┌────┴────┐          ┌────┴────┐   │
│    │Parachain│          │Parachain│          │Parachain│   │
│    │  Acala  │          │ Moonbeam│          │  Astar  │   │
│    │  (DeFi) │          │  (EVM)  │          │ (dApps) │   │
│    └─────────┘          └─────────┘          └─────────┘   │
│                                                             │
│    ┌─────────┐          ┌─────────┐                        │
│    │Parachain│          │Parathread│                       │
│    │ Phala   │          │(pay-per-use)│                    │
│    │(privacy)│          └─────────┘                        │
│    └─────────┘                                             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## Core Components

Polkadot architecture разделена на два layer: Relay Chain (consensus, security, coordination) и Parachains (execution, state, applications).

### Relay Chain

Relay Chain — "сердце" Polkadot. Она **не** выполняет smart contracts и **не** обрабатывает user transactions напрямую. Её задача: coordinate parachains, finalize blocks, pass messages. DOT staking происходит здесь.

```
Purpose: Shared security, finality, cross-chain messaging

Does NOT:
- Execute smart contracts
- Handle user transactions directly

Does:
- Validator election (NPoS)
- Parachain slot auctions
- GRANDPA/BABE consensus
- XCMP message passing
```

### Parachains

Parachains — application-specific chains, которые подключаются к Relay Chain. Каждый parachain имеет свою state machine, свой token (опционально), свою logic. Но security inherit от Relay Chain — validators Relay Chain валидируют parachain blocks.

```
Parachain = application-specific blockchain

Characteristics:
- Custom state transition logic
- Own token economics (optional)
- Shared security from Relay Chain
- Slot lease (auction or parathreads)

Examples:
┌───────────────────────────────────────────────────────────┐
│  Acala: DeFi hub (stablecoin, DEX, liquid staking)       │
│  Moonbeam: EVM-compatible smart contracts                │
│  Astar: Multi-VM (EVM + WASM) dApp platform             │
│  Phala: Privacy-preserving computation                   │
│  Centrifuge: Real-world asset financing                  │
└───────────────────────────────────────────────────────────┘
```

## Consensus

Polkadot использует **hybrid consensus**: BABE для block production, GRANDPA для finality. Это разделение позволяет оптимизировать каждый компонент отдельно — fast block production + strong finality guarantees.

### BABE + GRANDPA

BABE (block production) и GRANDPA (finality) работают параллельно. BABE может создавать forks (вероятностный selection), но GRANDPA финализирует целые цепочки blocks сразу. Это даёт быстрые blocks с сильной eventual finality.

```
┌─────────────────────────────────────────────────────────────┐
│                 Hybrid Consensus                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  BABE (Block Production):                                   │
│  - Blind Assignment for Blockchain Extension               │
│  - VRF-based slot leader selection                         │
│  - Produces blocks every 6 seconds                         │
│  - Probabilistic (can have forks)                          │
│                                                             │
│  GRANDPA (Finality):                                        │
│  - GHOST-based Recursive Ancestor Deriving Prefix Agreement│
│  - Finalizes chains of blocks at once                      │
│  - Deterministic finality (no reorgs after)               │
│  - Can finalize even during network partitions             │
│                                                             │
│  Together:                                                  │
│  - Fast block production (BABE)                            │
│  - Strong finality guarantees (GRANDPA)                    │
│  - Separation allows optimizing each                       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### Nominated Proof of Stake (NPoS)

NPoS — уникальный staking mechanism Polkadot. Вместо delegation (как в Cosmos), используется **nomination**. Nominators выбирают до 16 validators, которым доверяют. Алгоритм Phragmén выбирает optimal set для максимизации decentralization. И nominators, и validators могут быть slashed.

```
Nominators → nominate validators they trust
              │
              ▼
         ┌─────────┐
         │ Phragmén│ (election algorithm)
         │ election│
         └────┬────┘
              │
              ▼
Active validator set (297 validators on Polkadot)

Slashing: Both validators AND nominators lose stake
Rewards: Distributed proportionally
```

## Parachain Lifecycle

Parachain slots — scarce resource. Их количество ограничено (~100 max), и они распределяются через **auctions**. Это создаёт unique economic dynamics: проекты конкурируют за slots, используя crowdloans для сбора DOT от community.

### Slot Auctions

Slot auctions используют "candle auction" mechanism с random end time — это prevents sniping (bidding at last second). Проекты lease slots на 6 недель — 2 года. Cost: миллионы долларов в DOT equivalent.

```
┌─────────────────────────────────────────────────────────────┐
│                   Slot Auction                               │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Candle Auction (modified):                                 │
│  - Bidding period: ~7 days                                  │
│  - Random end time (prevents sniping)                       │
│  - Highest bid wins slot                                    │
│                                                             │
│  Crowdloan:                                                 │
│  - Projects can crowdsource DOT for bidding                │
│  - Contributors loan DOT, get parachain tokens             │
│  - DOT returned after lease period                         │
│                                                             │
│  Lease periods:                                             │
│  - 6 weeks to 2 years (Polkadot)                           │
│  - Multiple periods can be leased at once                  │
│                                                             │
│  Cost: $1M - $50M+ equivalent in DOT                       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### Parathreads

```
Alternative to permanent slot:

- Pay-per-block model
- Auction for individual blocks
- Lower commitment, lower throughput
- Good for: low-activity chains, testing
```

## Cross-Chain Messaging

XCMP (Cross-Chain Message Passing) — native механизм для communication между parachains. В отличие от Cosmos IBC, XCMP **не требует relayers** — Relay Chain сама координирует message passing. Это более централизовано, но проще и быстрее.

### XCMP (Cross-Chain Message Passing)

XCMP сообщения проходят через Relay Chain. Текущая реализация — HRMP (Horizontal Relay-routed Message Passing) — все messages идут через Relay Chain. Будущий full XCMP позволит direct communication между parachains.

```
Parachain A                Relay Chain               Parachain B
     │                          │                         │
     │ XCM Message              │                         │
     │─────────────────────────►│                         │
     │                          │                         │
     │                    Include in Relay block          │
     │                          │                         │
     │                          │ Route to B              │
     │                          │────────────────────────►│
     │                          │                         │
     │                          │                    Execute
     │                          │                         │

Current: HRMP (Horizontal Relay-routed Message Passing)
         Messages go through Relay Chain

Future: Direct XCMP
        Messages between parachains directly
```

### XCM (Cross-Consensus Message Format)

```rust
// XCM instruction examples
enum Instruction {
    // Transfer assets
    TransferAsset {
        assets: MultiAssets,
        beneficiary: MultiLocation,
    },

    // Execute on destination
    Transact {
        origin_kind: OriginKind,
        call: Vec<u8>,
    },

    // Reserve-backed transfer
    ReserveAssetDeposited(MultiAssets),
}

// MultiLocation: universal address format
let sibling_parachain = MultiLocation {
    parents: 1,
    interior: X1(Parachain(2000))
};
```

## Substrate Framework

Substrate — modular framework для building blockchains, созданный Parity (компания Gavin Wood). Это "Cosmos SDK от Polkadot", но с несколькими unique features: runtime compiled to WASM, forkless upgrades (runtime обновляется через governance без hard fork), и rich ecosystem of pre-built pallets.

```
┌─────────────────────────────────────────────────────────────┐
│                     Substrate                                │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Pre-built pallets (modules):                               │
│  - pallet-balances (token transfers)                        │
│  - pallet-staking (PoS)                                     │
│  - pallet-contracts (WASM smart contracts)                  │
│  - pallet-evm (EVM compatibility)                           │
│  - pallet-xcm (cross-chain messaging)                       │
│                                                             │
│  Runtime = WASM blob                                        │
│  - Upgradeable without hard forks                           │
│  - Just update WASM code via governance                     │
│                                                             │
│  Client:                                                    │
│  - Networking (libp2p)                                      │
│  - Consensus (BABE, AURA, GRANDPA)                         │
│  - Database (RocksDB, ParityDB)                            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## Ecosystem Data

```sql
-- Parachain metrics
SELECT
    parachain_name,
    DATE(block_timestamp) as date,
    COUNT(*) as extrinsic_count,
    COUNT(DISTINCT signer) as unique_signers
FROM polkadot.extrinsics
WHERE block_timestamp > CURRENT_DATE - INTERVAL '30 days'
GROUP BY parachain_name, date
ORDER BY date DESC, extrinsic_count DESC;

-- XCM messages
SELECT
    source_parachain,
    dest_parachain,
    message_type,
    COUNT(*) as message_count
FROM polkadot.xcm_messages
WHERE block_timestamp > CURRENT_DATE - INTERVAL '7 days'
GROUP BY source_parachain, dest_parachain, message_type
ORDER BY message_count DESC;

-- Slot auctions
SELECT
    auction_index,
    winning_parachain,
    winning_bid / 1e10 as bid_dot,
    lease_period_start,
    lease_period_end
FROM polkadot.auctions
ORDER BY auction_index DESC
LIMIT 20;
```

## Polkadot vs Cosmos

| Aspect | Polkadot | Cosmos |
|--------|----------|--------|
| Security | Shared (Relay Chain) | Independent per chain |
| Interoperability | XCMP (native) | IBC (protocol) |
| Chain creation | Slot auction / parathread | Deploy Cosmos SDK chain |
| Governance | On-chain (Relay + parachains) | Per-chain |
| Finality | GRANDPA (~12-60s) | Tendermint (~6s) |
| Validator set | Shared (~300) | Per-chain (~100-180) |

## Резюме

- Polkadot: heterogeneous multi-chain with shared security
- Relay Chain: consensus, не execution
- Parachains: app-specific chains, slot auctions
- BABE + GRANDPA: hybrid consensus (production + finality)
- XCMP/XCM: native cross-chain messaging
- Substrate: modular framework, upgradeable WASM runtime
- Trade-off: shared security vs slot cost and competition
